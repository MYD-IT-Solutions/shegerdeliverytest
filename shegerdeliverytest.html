<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sheger Deliveries - Test Execution Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
</head>

<body class="bg-gray-50 text-gray-800">


    <form id="test-form">
        <!-- Walkthrough Overlay (shown only once, now top-right and persistent) -->
        <div id="walkthrough-backdrop" style="display:none; position:fixed; z-index:100; inset:0; pointer-events:none;">
            <div id="walkthrough-box"
                class="fixed top-6 right-6 bg-white border-l-4 border-indigo-500 p-4 rounded-xl shadow-2xl flex flex-col items-start max-w-xs w-full z-50"
                style="min-width:240px; pointer-events:auto;">
                <div id="walkthrough-content" class="flex-1 w-full text-sm"></div>
                <div class="flex w-full justify-between mt-3">
                    <button id="walkthrough-prev" class="text-indigo-600 font-bold px-2 py-1 rounded hover:bg-indigo-50"
                        style="display:none;">Previous</button>
                    <div class="flex-1"></div>
                    <button id="walkthrough-next"
                        class="bg-indigo-600 text-white font-bold px-3 py-1 rounded hover:bg-indigo-700">Next</button>
                    <button id="walkthrough-finish"
                        class="bg-green-600 text-white font-bold px-3 py-1 rounded hover:bg-green-700 ml-2"
                        style="display:none;">Finish</button>
                </div>
            </div>
        </div>
        <!-- Walkthrough Reset Button (for testing only, remove in prod) -->
        <button id="reset-walkthrough-btn" type="button"
            class="fixed top-2 right-2 z-110 bg-yellow-200 text-yellow-900 px-2 py-1 rounded shadow hover:bg-yellow-300 text-xs font-bold"
            style="display:block;">Reset Walkthrough</button>

        <div class="container mx-auto p-4 md:p-8 max-w-4xl">
            <!-- Progress Bar -->
            <div id="progress-bar" class="flex items-center mb-8">
                <!-- Progress steps will be injected here by JS -->
            </div>

            <!-- Step 1: Intro & Tester Name -->
            <div class="step" data-step="1">



                <div class="bg-white p-6 rounded-xl shadow-sm mb-8">
                    <div class="flex justify-center mb-6">
                        <img src="assets/img/logo.png" alt="Sheger Deliveries Logo" class="h-20 md:h-28 w-auto"
                            style="max-width:320px;">
                    </div>
                    <!-- QR Code -->
                    <div class="flex flex-col items-center">
                        <img src="assets/img/QR.png" alt="QR Code to Mobile App"
                            class="h-40 w-40 mb-2 border border-gray-300 rounded-md bg-white">
                    </div>
                    <div class="mt-6 flex flex-row justify-center items-center gap-1">
                        <a href="https://shegerdeliveries.com/" target="_blank"
                            class="inline-flex items-center h-12 px-4 bg-indigo-600 text-white rounded-lg font-semibold shadow hover:bg-indigo-700 transition-colors"
                            style="margin-right:2px;">
                            <img src="assets/img/web.svg" class="h-6 w-6 mr-2" alt="web icon"
                                style="filter: brightness(0) invert(1);">
                            Open Website
                        </a>
                        <a href="https://play.google.com/store/apps/developer?id=Sheger+Deliveries" target="_blank">
                            <img src="assets/img/googleplay.png" alt="Get it on Google Play" class="h-12 w-auto">
                        </a>
                    </div>
                </div>
                <div class="form-section shadow-sm">
                    <div class="form-section-header">
                        <h2 class="text-xl font-semibold">Tester Information</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="tester_name" class="block text-sm font-medium text-gray-700 mb-1">Tester
                                Name</label>
                            <input type="text" id="tester_name" name="tester_name"
                                class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                                required>
                        </div>
                        <div>
                            <label for="test_date" class="block text-sm font-medium text-gray-700 mb-1">Date of
                                Testing</label>
                            <input type="text" id="test_date" name="test_date"
                                class="w-full p-2 border-gray-300 rounded-md shadow-sm bg-gray-100" readonly>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: 1.1 Common Pages -->
            <div class="step hidden" data-step="2">
                <div class="form-section shadow-sm">
                    <div class="form-section-header">
                        <h2 class="text-2xl font-bold">1.1 Web Application - Common Pages</h2>
                    </div>
                    <div id="web-common-pages"></div>
                </div>
            </div>

            <!-- Step 3: 1.2 Customer Portal -->
            <div class="step hidden" data-step="3">
                <div class="form-section shadow-sm">
                    <div class="form-section-header">
                        <h2 class="text-2xl font-bold">1.2 Web Application - Customer Portal</h2>
                    </div>
                    <div id="web-customer-portal"></div>
                </div>
            </div>

            <!-- Step 4: 1.3 Store Portal -->
            <div class="step hidden" data-step="4">
                <div class="form-section shadow-sm">
                    <div class="form-section-header">
                        <h2 class="text-2xl font-bold">1.3 Web Application - Store Portal</h2>
                    </div>
                    <div id="web-store-portal"></div>
                </div>
            </div>

            <!-- Step 5: 1.4 Provider Portal -->
            <div class="step hidden" data-step="5">
                <div class="form-section shadow-sm">
                    <div class="form-section-header">
                        <h2 class="text-2xl font-bold">1.4 Web Application - Provider Portal</h2>
                    </div>
                    <div id="web-provider-portal"></div>
                </div>
            </div>

            <!-- Step 6: 2.1 Customer Application -->
            <div class="step hidden" data-step="6">
                <div class="form-section shadow-sm">
                    <div class="form-section-header">
                        <h2 class="text-2xl font-bold">2.1 Mobile Application - Customer Application</h2>
                    </div>
                    <div id="mobile-customer-app"></div>
                </div>
            </div>

            <!-- Step 7: 2.2 Store Application -->
            <div class="step hidden" data-step="7">
                <div class="form-section shadow-sm">
                    <div class="form-section-header">
                        <h2 class="text-2xl font-bold">2.2 Mobile Application - Store Application</h2>
                    </div>
                    <div id="mobile-store-app"></div>
                </div>
            </div>

            <!-- Step 8: 2.3 Driver Application -->
            <div class="step hidden" data-step="8">
                <div class="form-section shadow-sm">
                    <div class="form-section-header">
                        <h2 class="text-2xl font-bold">2.3 Mobile Application - Driver Application</h2>
                    </div>
                    <div id="mobile-driver-app"></div>
                </div>
            </div>

            <!-- Navigation Buttons -->
            <div class="flex justify-between items-center mt-8">
                <div>
                    <button type="button" id="reset-progress-btn"
                        class="bg-gray-300 text-gray-700 font-bold py-2 px-6 rounded-lg hover:bg-gray-400 transition-colors">Reset
                        Progress</button>
                </div>
                <div class="flex space-x-4 items-center">
                    <button type="button" id="prev-btn"
                        class="bg-gray-200 text-gray-700 font-bold py-2 px-6 rounded-lg hover:bg-gray-300 transition-colors">Previous</button>
                    <button type="button" id="next-btn"
                        class="bg-indigo-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-indigo-700 transition-colors">Next</button>
                    <button type="submit" id="submit-btn"
                        class="bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 transition-colors hidden">Submit
                        Test Results</button>
                </div>
            </div>
        </div>
    </form>

    <!-- Test Case Detail Modal replaced by inline collapsible details. See JS for rendering logic. -->


    <!-- Results Modal -->
    <div id="results-modal"
        class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4 z-50 modal-overlay hidden opacity-0">
        <div
            class="bg-white rounded-xl shadow-2xl w-full max-w-3xl max-h-[90vh] overflow-hidden flex flex-col modal-container transform scale-95">
            <div class="p-6 border-b border-gray-200">
                <h2 class="text-2xl font-bold">Test Execution Summary</h2>
            </div>
            <div class="p-6 overflow-y-auto flex-grow">
                <h3 class="font-semibold text-lg mb-2">Tester Info:</h3>
                <p id="modal-tester-info" class="mb-4 p-3 bg-gray-100 rounded-md"></p>
                <h3 class="font-semibold text-lg mb-2">Results (JSON):</h3>
                <p class="text-sm text-gray-600 mb-2">You can copy the text below and paste it into a JSON viewer or a
                    spreadsheet.</p>
                <textarea id="modal-results-json"
                    class="w-full h-64 p-3 border border-gray-300 rounded-md font-mono text-sm bg-gray-50"
                    readonly></textarea>
            </div>
            <div class="p-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3">
                <button id="export-json-btn"
                    class="bg-green-600 text-white font-bold py-2 px-5 rounded-lg hover:bg-green-700 transition-colors">Export
                    JSON</button>
                <button id="close-modal-btn"
                    class="bg-indigo-600 text-white font-bold py-2 px-5 rounded-lg hover:bg-indigo-700 transition-colors">Close</button>
            </div>
        </div>
    </div>

    <script src="assets/js/main.js"></script>
    <script>
        // Interactive walkthrough logic: show only once, persistent, and top-right
        document.addEventListener('DOMContentLoaded', function () {
            // Walkthrough reset button for testing
            var resetBtn = document.getElementById('reset-walkthrough-btn');
            if (resetBtn) {
                resetBtn.onclick = function () {
                    localStorage.removeItem('sdtest_walkthrough_done');
                    location.reload();
                };
            }

            // Always allow walkthrough for testing (remove in prod)
            var showWalkthrough = !localStorage.getItem('sdtest_walkthrough_done');
            // Helper to set dev mode globally
            function setDevMode(val) {
                if (typeof window.setDevModeFlag === 'function') window.setDevModeFlag(val);
            }
            // Enable dev mode for walkthrough and only show step 1 and 2 in UI
            if (showWalkthrough) {
                setDevMode(true);
                // Hide all steps except 1 and 2
                var allSteps = document.querySelectorAll('.step');
                allSteps.forEach(function (stepDiv) {
                    var stepNum = stepDiv.getAttribute('data-step');
                    if (stepNum !== '1' && stepNum !== '2') stepDiv.style.display = 'none';
                    else stepDiv.style.display = '';
                });
                // Hide all progress bar steps except 1 and 2 (after progress bar is rendered)
                setTimeout(function () {
                    var progressBar = document.getElementById('progress-bar');
                    if (progressBar) {
                        var stepEls = progressBar.querySelectorAll('.progress-step');
                        stepEls.forEach(function (el) {
                            var stepNum = el.getAttribute('data-step');
                            if (stepNum !== '1' && stepNum !== '2') el.style.display = 'none';
                            else el.style.display = '';
                        });
                    }
                }, 0);
            }

            // Add walkthrough arrow style
            var arrowStyle = document.createElement('style');
            arrowStyle.innerHTML = `.walkthrough-arrow { position: absolute; z-index: 200; pointer-events: none; width: 60px; height: 60px; }
        .walkthrough-arrow svg { width: 60px; height: 60px; }
        @media (max-width: 600px) { .walkthrough-arrow { width: 36px; height: 36px; } .walkthrough-arrow svg { width: 36px; height: 36px; } }`;
            document.head.appendChild(arrowStyle);
            var arrowDiv = document.createElement('div');
            arrowDiv.className = 'walkthrough-arrow';
            arrowDiv.style.display = 'none';
            arrowDiv.innerHTML = '<svg viewBox="0 0 60 60"><polygon points="0,0 60,30 0,60" fill="#6366f1"/></svg>';
            document.body.appendChild(arrowDiv);

            var steps = [
                {
                    html: `<h3 class="font-semibold text-indigo-800 mb-2 text-lg">Welcome to the Test Execution Walkthrough</h3>
        <p class="text-gray-700 mb-2">This quick guide will show you how to fill out and submit a test case. Click <b>Next</b> to begin.</p>`
                },
                {
                    html: `<b>Step 1: Enter Your Name</b><br><span class="text-gray-700">Type your name in the <b>Tester Name</b> field. (We'll do it for you in this example.)</span>`,
                    highlight: '#tester_name',
                    action: function () {
                        var input = document.getElementById('tester_name');
                        if (input) input.value = 'Example Tester';
                    }
                },
                {
                    html: `<b>Step 2: Scan the QR or Use the App/Web Links</b><br><span class="text-gray-700">You can scan the QR code or use the buttons below to access the app or website.</span>`,
                    highlight: '.h-40.w-40.mb-2',
                },
                {
                    html: `<b>Step 3: Click Next to Start Testing</b><br><span class="text-gray-700">Let's proceed to the first test case section.</span>`,
                    highlight: '#next-btn',
                    action: null,
                    autoAdvance: null
                },
                {
                    html: `<b>Step 4: Read the Test Case Details</b><br><span class="text-gray-700">The first test case details are now opened for you. <br><span style='color:#16a34a;font-weight:bold;'>Watch as the details expand and the indicator turns green.</span></span>`,
                    highlight: '.testcase-header',
                    action: function () {
                        // Find the toggle button for WEB-LND-01
                        var toggleBtn = document.querySelector('.test-case-toggle[data-toggle-detail="WEB-LND-01"]');
                        var indicator = toggleBtn ? toggleBtn.querySelector('svg') : null;
                        var detailPanel = document.getElementById('detail-WEB-LND-01');
                        // First, ensure details are closed
                        if (toggleBtn && detailPanel && !detailPanel.classList.contains('hidden')) {
                            toggleBtn.click(); // close if open
                        }
                        if (indicator) indicator.style.color = '';
                        // After a short delay, open and highlight
                        setTimeout(function () {
                            if (toggleBtn && detailPanel && detailPanel.classList.contains('hidden')) {
                                toggleBtn.click();
                                if (indicator) {
                                    indicator.style.color = '#16a34a';
                                    indicator.style.transition = 'color 0.3s';
                                    setTimeout(function () {
                                        indicator.style.color = '';
                                    }, 1200);
                                }
                            }
                        }, 700);
                    }
                },
                {
                    html: `<b>Step 5: Select a Status</b><br><span class="text-gray-700">Choose <b>Pass</b>, <b>Fail</b>, or <b>Blocked</b> for the test case.<br><span style='color:#6366f1;font-weight:bold;'>Watch as the status is selected for you.</span></span>`,
                    highlight: 'select[data-status-select="WEB-LND-01"]',
                    action: function () {
                        var select = document.querySelector('select[data-status-select="WEB-LND-01"]');
                        if (select) {
                            select.classList.add('walkthrough-pulse');
                            // Show arrow pointing to select
                            var rect = select.getBoundingClientRect();
                            var arrow = document.querySelector('.walkthrough-arrow');
                            if (arrow) {
                                arrow.style.display = '';
                                arrow.style.left = (window.scrollX + rect.left + rect.width / 2 - 30) + 'px';
                                arrow.style.top = (window.scrollY + rect.bottom + 8) + 'px';
                                arrow.style.transform = 'rotate(90deg)';
                            }
                            setTimeout(function () {
                                select.value = 'Pass';
                                select.dispatchEvent(new Event('change', { bubbles: true }));
                                select.classList.add('walkthrough-pulse');
                                setTimeout(function () {
                                    select.classList.remove('walkthrough-pulse');
                                    if (arrow) arrow.style.display = 'none';
                                }, 1000);
                            }, 900);
                        }
                    }
                },
                {
                    html: `<b>Step 6: Enter a Comment</b><br><span class="text-gray-700">Add a comment for the test case.<br><span style='color:#6366f1;font-weight:bold;'>Comments are <b>required</b> for <b>Fail</b> and <b>Blocked</b>, but <b>optional</b> for Pass.<br>Watch as the comment is filled in for you.</span></span>`,
                    highlight: 'input[data-comment-input="WEB-LND-01"]',
                    action: function () {
                        var commentBox = document.querySelector('input[data-comment-input="WEB-LND-01"]');
                        if (commentBox) {
                            commentBox.classList.add('walkthrough-pulse');
                            // Show arrow pointing to comment input
                            var rect = commentBox.getBoundingClientRect();
                            var arrow = document.querySelector('.walkthrough-arrow');
                            if (arrow) {
                                arrow.style.display = '';
                                arrow.style.left = (window.scrollX + rect.left + rect.width / 2 - 30) + 'px';
                                arrow.style.top = (window.scrollY + rect.bottom + 8) + 'px';
                                arrow.style.transform = 'rotate(90deg)';
                            }
                            setTimeout(function () {
                                commentBox.value = 'All checks passed.';
                                commentBox.classList.add('walkthrough-pulse');
                                setTimeout(function () {
                                    commentBox.classList.remove('walkthrough-pulse');
                                    if (arrow) arrow.style.display = 'none';
                                }, 1000);
                            }, 900);
                        }
                    }
                },
                {
                    html: `<b>Step 7: Submit Your Results</b><br><span class="text-gray-700">Click <b>Submit</b> to finish. (We'll do it for you in this example.)</span>`,
                    highlight: '#submit-btn',
                    action: function () {
                        // Only auto-submit if currently on step 2 (test case step)
                        var step2 = document.querySelector('.step[data-step="2"]');
                        if (step2 && !step2.classList.contains('hidden')) {
                            setTimeout(function () {
                                document.getElementById('submit-btn').click();
                            }, 800);
                        }
                    },
                    autoAdvance: 1500
                },
                {
                    html: `<b>That's it!</b><br><span class="text-gray-700">You've completed the walkthrough. Now you can start your own test session. Good luck!</span>`
                }
            ];
            var step = 0;
            var backdrop = document.getElementById('walkthrough-backdrop');
            var box = document.getElementById('walkthrough-box');
            var content = document.getElementById('walkthrough-content');
            var btnNext = document.getElementById('walkthrough-next');
            var btnPrev = document.getElementById('walkthrough-prev');
            var btnFinish = document.getElementById('walkthrough-finish');
            var highlightEl = null;

            function showArrow(target) {
                if (!target) { arrowDiv.style.display = 'none'; return; }
                var rect = target.getBoundingClientRect();
                arrowDiv.style.display = '';
                // Place arrow to the left or above the element
                arrowDiv.style.left = (window.scrollX + rect.left - 70) + 'px';
                arrowDiv.style.top = (window.scrollY + rect.top + rect.height / 2 - 30) + 'px';
            }

            function showStep(idx) {
                // Remove previous highlight
                if (highlightEl) {
                    highlightEl.classList.remove('walkthrough-highlight');
                    highlightEl = null;
                }
                var s = steps[idx];
                content.innerHTML = s.html;
                // Highlight element if needed
                if (s.highlight) {
                    highlightEl = document.querySelector(s.highlight);
                    if (highlightEl) highlightEl.classList.add('walkthrough-highlight');
                    showArrow(highlightEl);
                } else {
                    showArrow(null);
                }
                // Run action if any
                if (typeof s.action === 'function') s.action();
                // Button visibility
                btnPrev.style.display = idx > 0 ? '' : 'none';
                btnNext.style.display = (idx < steps.length - 1) ? '' : 'none';
                btnFinish.style.display = (idx === steps.length - 1) ? '' : 'none';
                // Auto-advance if needed
                if (s.autoAdvance) {
                    setTimeout(function () {
                        if (step === idx) nextStep();
                    }, s.autoAdvance);
                }
                // Special: only at walkthrough step 3, clicking Next should advance the form stepper
                if (idx === 3) {
                    btnNext.onclick = function () {
                        // Advance walkthrough
                        step++;
                        showStep(step);
                        // Advance form stepper
                        document.getElementById('next-btn').click();
                    };
                } else {
                    btnNext.onclick = nextStep;
                }
            }
            function nextStep() {
                if (step < steps.length - 1) {
                    step++;
                    showStep(step);
                }
            }
            function prevStep() {
                if (step > 0) {
                    step--;
                    showStep(step);
                }
            }
            function finishWalkthrough() {
                if (highlightEl) highlightEl.classList.remove('walkthrough-highlight');
                showArrow(null);
                backdrop.style.display = 'none';
                localStorage.setItem('sdtest_walkthrough_done', '1');
                // Clear saved progress and walkthrough state
                localStorage.removeItem('sdtest_progress');
                localStorage.removeItem('sdtest_results');
                // Disable dev mode after walkthrough
                setDevMode(false);
                // Show all steps again
                var allSteps = document.querySelectorAll('.step');
                allSteps.forEach(function (stepDiv) { stepDiv.style.display = ''; });
                // Reset to step 1 and reload full data (simulate page reload)
                setTimeout(function () {
                    // If you have a function to reload all data, call it here. Otherwise, reload the page.
                    location.reload();
                }, 400);
            }
            // Add highlight and pulse styles
            var style = document.createElement('style');
            style.innerHTML = `.walkthrough-highlight { box-shadow: 0 0 0 4px #6366f1aa, 0 2px 8px #0002 !important; z-index: 101 !important; position: relative !important; border-radius: 8px !important; }
            .walkthrough-pulse { animation: walkthrough-pulse 1.2s; }
            @keyframes walkthrough-pulse { 0% { box-shadow: 0 0 0 0 #6366f1aa; } 70% { box-shadow: 0 0 0 8px #6366f122; } 100% { box-shadow: 0 0 0 0 #6366f100; } }`;
            document.head.appendChild(style);
            // Show overlay if needed
            if (showWalkthrough) {
                backdrop.style.display = '';
                showStep(step);
            }
            btnNext.onclick = nextStep;
            btnPrev.onclick = prevStep;
            btnFinish.onclick = finishWalkthrough;
            // Dismiss on clicking backdrop (except box)
            backdrop.addEventListener('click', function (e) {
                if (e.target === backdrop) finishWalkthrough();
            });

            // Make walkthrough persistent across steps
            window.showWalkthroughBox = function () {
                backdrop.style.display = '';
                showStep(step);
            };
            window.hideWalkthroughBox = function () {
                backdrop.style.display = 'none';
                // Disable dev mode if walkthrough is skipped
                setDevMode(false);
                // Show all steps again
                var allSteps = document.querySelectorAll('.step');
                allSteps.forEach(function (stepDiv) { stepDiv.style.display = ''; });
            };
        });
    </script>

</body>

</html>